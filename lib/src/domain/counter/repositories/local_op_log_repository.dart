import 'package:supa_counter/src/domain/counter/operations/counter_operation.dart';

/// Репозиторий для локального хранения операций счетчика (op-log).
///
/// Предоставляет интерфейс для сохранения и загрузки операций локально.
/// Все операции сохраняются в порядке добавления и могут быть восстановлены
/// для вычисления состояния счетчика.
///
/// Репозиторий обеспечивает:
/// - Персистентность операций между перезапусками приложения
/// - Дедупликацию операций по `op_id`
/// - Ограничение роста op-log (удаление старых операций)
abstract class LocalOpLogRepository {
  /// Инициализирует репозиторий.
  ///
  /// Должен быть вызван перед использованием репозитория.
  /// Выполняет миграции схемы данных, если необходимо.
  Future<void> initialize();

  /// Добавляет операцию в op-log.
  ///
  /// Параметры:
  /// - [operation] - операция для добавления
  ///
  /// Операция будет сохранена локально. Если операция с таким же `op_id`
  /// уже существует, она не будет добавлена повторно (дедупликация).
  Future<void> append(CounterOperation operation);

  /// Возвращает все операции из op-log.
  ///
  /// Операции возвращаются в порядке добавления.
  /// Если op-log пуст, возвращается пустой список.
  Future<List<CounterOperation>> getAll();

  /// Очищает все операции из op-log.
  ///
  /// Используется в основном для тестов.
  Future<void> clear();
}
